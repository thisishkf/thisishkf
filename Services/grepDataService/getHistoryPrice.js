const request = require('request');

const getHistoryPrice = function (code, data) {
	const API_URI = "https://query1.finance.yahoo.com/v8/finance/chart/#CODE#.HK";
	var uri = API_URI.replace("#CODE#", `${code}`);
	
	let query = buildQuery(data);
	uri+=query;
	console.log(uri);
	request(uri, function (error, response, html) {
		console.log('error:', error); // Print the error if one occurred
		console.log('statusCode:', response && response.statusCode); // Print the response status code if a response was received
		if (!error && response.statusCode == 200) {
			console.log(html);
		}
	});
}

var buildQuery = function (json) {
	var query = "?";
	Object.keys(json).forEach(key => {
		query += `${key}=${json[key]}&`
	});
	return query.substring(0, query.length - 1);
}
let data = {
	region: "HK",
	lang: "zh-Hant-HK",
	range: "1d",
	includePrePost: false,
	interval: "2m",
	corsDomain: "hk.finance.yahoo.com",
	".tsrc": "finance"
};
getHistoryPrice(2800 , data);

// var sample = {
// 	"chart": {
// 		"result": [{
// 			"meta": {
// 				"currency": "HKD",
// 				"symbol": "2800.HK",
// 				"exchangeName": "HKG",
// 				"instrumentType": "EQUITY",
// 				"firstTradeDate": 1199062800,
// 				"gmtoffset": 28800,
// 				"timezone": "HKT",
// 				"exchangeTimezoneName": "Asia/Hong_Kong",
// 				"chartPreviousClose": 30.6,
// 				"previousClose": 30.6,
// 				"scale": 3,
// 				"currentTradingPeriod": {
// 					"pre": {
// 						"timezone": "HKT",
// 						"start": 1523322000, "end": 1523323800, "gmtoffset": 28800
// 					},
// 					"regular": {
// 						"timezone": "HKT",
// 						"start": 1523323800, "end": 1523347800, "gmtoffset": 28800
// 					}, "post": { "timezone": "HKT", "start": 1523347800, "end": 1523347800, "gmtoffset": 28800 }
// 				}, "tradingPeriods": [[
// 					{ "timezone": "HKT", "start": 1523323800, "end": 1523347800, "gmtoffset": 28800 }
// 				]],
// 				"dataGranularity": "2m",
// 				"validRanges": ["1d", "5d", "1mo", "3mo", "6mo", "1y", "2y", "5y", "10y", "ytd", "max"]
// 			},
// 			"timestamp": [1523323800, 1523323920, 1523324040, 1523324160, 1523324280, 1523324400, 1523324520, 1523324640, 1523324760, 1523324880, 1523325000, 1523325120, 1523325240, 1523325360, 1523325480, 1523325600, 1523325720, 1523325840, 1523325960, 1523326080, 1523326200, 1523326320, 1523326440, 1523326560, 1523326680, 1523326800, 1523326920, 1523327040, 1523327160, 1523327280, 1523327400, 1523327520, 1523327640, 1523327760, 1523327880, 1523328000, 1523328120, 1523328240, 1523328360, 1523328480, 1523328600, 1523328720, 1523328840, 1523328960, 1523329080, 1523329200, 1523329320, 1523329440, 1523329560, 1523329680, 1523329800, 1523329920, 1523330040, 1523330160, 1523330280, 1523330400, 1523330520, 1523330640, 1523330760, 1523330880, 1523331000, 1523331120, 1523331240, 1523331360, 1523331480, 1523331600, 1523331720, 1523331840, 1523331960, 1523332080, 1523332200, 1523332320, 1523332440, 1523332560, 1523332680, 1523332800, 1523332920, 1523333040, 1523333160, 1523333280, 1523333400, 1523333520, 1523333640, 1523333760, 1523333880, 1523334000, 1523334120, 1523334240, 1523334360, 1523334480, 1523334600, 1523334720, 1523334840, 1523334960, 1523335080, 1523335200, 1523335320, 1523335440, 1523335560, 1523335680, 1523335800, 1523335920, 1523336040, 1523336160, 1523336280, 1523336400, 1523336520, 1523336640, 1523336760, 1523336880, 1523337000, 1523337120, 1523337240, 1523337360, 1523337480, 1523337600, 1523337720, 1523337840, 1523337960, 1523338080, 1523338200, 1523338320, 1523338440, 1523338560, 1523338680, 1523338800, 1523338920, 1523339040, 1523339160, 1523339280, 1523339400, 1523339520, 1523339640, 1523339760, 1523339880, 1523340000, 1523340120, 1523340240, 1523340360, 1523340480, 1523340600],
// 			"indicators": {
// 				"quote": [{
// 					"close": [30.549999237060547, 30.549999237060547, 30.600000381469727, 30.549999237060547, 30.5, 30.5, 30.549999237060547, 30.600000381469727, 30.600000381469727, null, 30.649999618530273, 30.649999618530273, 30.75, 30.700000762939453, 30.700000762939453, 30.700000762939453, 30.700000762939453, null, null, 30.700000762939453, 30.700000762939453, 30.75, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, null, 30.899999618530273, 30.850000381469727, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, null, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, null, 30.850000381469727, 30.799999237060547, null, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.899999618530273, 30.899999618530273, 31.0, 30.950000762939453, 30.899999618530273, 30.950000762939453, 30.899999618530273, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 30.950000762939453, 30.950000762939453, null, 31.0, 31.0, 31.0, 30.950000762939453, 31.0, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, null, 30.950000762939453, 30.950000762939453, 30.950000762939453, 31.0, 31.0, 31.0, 31.0, 31.049999237060547, 31.0, 31.0, 30.950000762939453, 31.0, 31.0, 31.0, 31.049999237060547, 31.0, 31.049999237060547, 31.049999237060547, 31.049999237060547, 31.049999237060547, 31.100000381469727, null],
// 					"volume": [111000, 134000, 1228100, 450500, 170750, 1743000, 7000, 290000, 102000, null, 110500, 60000, 1698500, 4000, 43620, 180000, 166900, null, null, 1000, 9000, 1131100, 173000, 1172460, 991000, 8500, 35000, null, 1493500, 275500, 5765, 346500, 12000, 23000, 16000, 195000, 18826, 114654, 12500, null, 19500, 1125500, 6632, 154500, 119562, 14000, 169000, 207500, 2500, 42500, 9380, 18840, null, 117158, 4000, null, 9702, 115000, 1500, 2510, 18000, 100500, 630000, 1500, 15000, 14000, 2000, 34000, 3500, 57000, 1059000, 141125, 20000, 500, 24740, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 11000, 42500, null, 639140, 710000, 2000, 2500, 14000, 107050, 1065, 4000, 1000, 999000, null, 2500, 7000, 6000, 2500, 1000, 1500, 86000, 1504000, 5245, 130340, 6500, 10000, 256512, 30500, 8000, 8500, 12000, 11500, 191075, 35321, 22715, null],
// 					"open": [30.549999237060547, 30.600000381469727, 30.549999237060547, 30.549999237060547, 30.549999237060547, 30.5, 30.549999237060547, 30.549999237060547, 30.600000381469727, null, 30.649999618530273, 30.649999618530273, 30.649999618530273, 30.700000762939453, 30.700000762939453, 30.700000762939453, 30.700000762939453, null, null, 30.700000762939453, 30.700000762939453, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, null, 30.850000381469727, 30.899999618530273, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, null, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.799999237060547, 30.850000381469727, 30.850000381469727, 30.850000381469727, null, 30.850000381469727, 30.799999237060547, null, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.950000762939453, 30.899999618530273, 30.950000762939453, 30.950000762939453, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 30.950000762939453, 30.950000762939453, null, 31.0, 31.0, 31.0, 30.950000762939453, 31.0, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, null, 30.950000762939453, 30.950000762939453, 30.950000762939453, 31.0, 31.0, 31.0, 31.0, 31.049999237060547, 31.0, 31.0, 30.950000762939453, 31.0, 30.950000762939453, 31.0, 31.0, 31.0, 31.0, 31.0, 31.0, 31.049999237060547, 31.049999237060547, null],
// 					"low": [30.549999237060547, 30.549999237060547, 30.549999237060547, 30.549999237060547, 30.5, 30.5, 30.549999237060547, 30.549999237060547, 30.600000381469727, null, 30.649999618530273, 30.649999618530273, 30.649999618530273, 30.700000762939453, 30.700000762939453, 30.700000762939453, 30.700000762939453, null, null, 30.700000762939453, 30.700000762939453, 30.75, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, null, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, null, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.799999237060547, 30.850000381469727, 30.850000381469727, 30.850000381469727, null, 30.850000381469727, 30.799999237060547, null, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.950000762939453, 30.899999618530273, 30.950000762939453, 30.899999618530273, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 30.950000762939453, 30.950000762939453, null, 31.0, 31.0, 31.0, 30.950000762939453, 31.0, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, null, 30.950000762939453, 30.950000762939453, 30.950000762939453, 31.0, 31.0, 31.0, 31.0, 31.049999237060547, 31.0, 31.0, 30.950000762939453, 31.0, 30.950000762939453, 31.0, 31.0, 31.0, 31.0, 31.0, 31.0, 31.0, 31.049999237060547, null],
// 					"high": [30.600000381469727, 30.600000381469727, 30.600000381469727, 30.549999237060547, 30.549999237060547, 30.5, 30.549999237060547, 30.600000381469727, 30.600000381469727, null, 30.649999618530273, 30.649999618530273, 30.75, 30.700000762939453, 30.700000762939453, 30.700000762939453, 30.700000762939453, null, null, 30.700000762939453, 30.700000762939453, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.799999237060547, null, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, null, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.899999618530273, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, null, 30.850000381469727, 30.799999237060547, null, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.799999237060547, 30.799999237060547, 30.799999237060547, 30.850000381469727, 30.850000381469727, 30.850000381469727, 30.899999618530273, 30.899999618530273, 31.0, 30.950000762939453, 30.899999618530273, 30.950000762939453, 30.950000762939453, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 30.950000762939453, 30.950000762939453, null, 31.0, 31.0, 31.0, 30.950000762939453, 31.0, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, 30.950000762939453, null, 30.950000762939453, 30.950000762939453, 30.950000762939453, 31.0, 31.0, 31.0, 31.0, 31.049999237060547, 31.0, 31.0, 30.950000762939453, 31.0, 31.0, 31.0, 31.049999237060547, 31.0, 31.049999237060547, 31.049999237060547, 31.049999237060547, 31.049999237060547, 31.100000381469727, null]
// 				}]
// 			}
// 		}], "error": null
// 	}
// };